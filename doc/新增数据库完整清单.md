# æ–°å¢æ•°æ®åº“å®Œæ•´æ¸…å•

æœ¬æ–‡æ¡£è¯´æ˜åœ¨ QTRAN æ¡†æ¶ä¸­æ–°å¢ä¸€ä¸ªæ•°æ®åº“æ—¶éœ€è¦ä¿®æ”¹çš„æ‰€æœ‰ä½ç½®ã€‚ä»¥ SurrealDB ä¸ºä¾‹ã€‚

---

## ğŸ“‹ æ¸…å•æ¦‚è§ˆ

- [ ] **1. Docker å®¹å™¨é…ç½®**
- [ ] **2. æ•°æ®åº“è¿æ¥å‚æ•°é…ç½®**
- [ ] **3. æ•°æ®åº“è¿æ¥å™¨ä»£ç **
- [ ] **4. çŸ¥è¯†åº“åˆ›å»º**
- [ ] **5. çŸ¥è¯†åº“å¯¼å…¥å™¨é›†æˆ**
- [ ] **6. ç¿»è¯‘æµç¨‹é›†æˆ**
- [ ] **7. é¢„å¤„ç†è„šæœ¬ï¼ˆå¯é€‰ï¼‰**
- [ ] **8. æµ‹è¯•éªŒè¯**

---

## 1. Docker å®¹å™¨é…ç½® âœ…

### æ–‡ä»¶ï¼š`docker-compose.yml`

**ç›®çš„**ï¼šå°†æ–°æ•°æ®åº“æ·»åŠ åˆ° Docker Compose é›†ç¾¤ä¸­

**ä½ç½®**ï¼š
```yaml
services:
  # ... å…¶ä»–æœåŠ¡ ...
  
  surrealdb:  # æ–°å¢çš„æ•°æ®åº“æœåŠ¡
    image: surrealdb/surrealdb:latest
    container_name: surrealdb_QTRAN
    command: start --log trace --user root --pass root memory
    ports:
      - "8000:8000"
    volumes:
      - surrealdb_data:/data
    networks:
      - db_network

volumes:
  # ... å…¶ä»–å· ...
  surrealdb_data:  # æ–°å¢æ•°æ®å·
```

**å…³é”®ç‚¹**ï¼š
- `container_name` å¿…é¡»ä»¥ `_QTRAN` ç»“å°¾
- å¿…é¡»åœ¨ `db_network` ç½‘ç»œä¸­
- ç«¯å£æ˜ å°„è¦é¿å…å†²çª
- æ·»åŠ æŒä¹…åŒ–å·ï¼ˆå¦‚æœéœ€è¦ï¼‰

**éªŒè¯**ï¼š
```bash
docker-compose up -d surrealdb
docker ps | grep surrealdb_QTRAN
```

---

## 2. æ•°æ®åº“è¿æ¥å‚æ•°é…ç½® âœ…

### æ–‡ä»¶ï¼š`src/Tools/DatabaseConnect/database_connector_args.json`

**ç›®çš„**ï¼šé…ç½®æ•°æ®åº“è¿æ¥ä¿¡æ¯

**ä½ç½®**ï¼šåœ¨ JSON å¯¹è±¡ä¸­æ–°å¢ä¸€ä¸ªé”®
```json
{
  "surrealdb": {
    "container_name": "surrealdb_QTRAN",
    "dbType": "surrealdb",
    "host": "127.0.0.1",
    "port": 8000,
    "container_port": 8000,
    "username": "root",
    "password": "root",
    "namespace": "test",
    "database": "test"
  }
}
```

**å…³é”®ç‚¹**ï¼š
- `container_name` å¿…é¡»ä¸ docker-compose.yml ä¸­ä¸€è‡´
- `dbType` ç”¨äºä»£ç ä¸­è¯†åˆ«æ•°æ®åº“ç±»å‹
- æ ¹æ®æ•°æ®åº“ç‰¹æ€§æ·»åŠ ç‰¹æœ‰å­—æ®µï¼ˆå¦‚ SurrealDB çš„ namespaceï¼‰

---

## 3. æ•°æ®åº“è¿æ¥å™¨ä»£ç  âœ…

### æ–‡ä»¶ï¼š`src/Tools/DatabaseConnect/database_connector.py`

**éœ€è¦ä¿®æ”¹ 3 ä¸ªä½ç½®**ï¼š

### 3.1 `__init__` æ–¹æ³•
```python
def __init__(
    self,
    container_name,
    dbType,
    host,
    port=None,
    username=None,
    password=None,
    database=None,
    **kwargs  # â† æ¥æ”¶é¢å¤–å‚æ•°
):
    # ... ç°æœ‰ä»£ç  ...
    self.kwargs = kwargs  # â† å­˜å‚¨é¢å¤–å‚æ•°
```

### 3.2 `create_engine` æ–¹æ³•
```python
def create_engine(self):
    # ... ç°æœ‰åˆ†æ”¯ ...
    
    elif self.dbType == "SURREALDB":  # â† æ–°å¢åˆ†æ”¯
        # SurrealDB ä½¿ç”¨ HTTP APIï¼Œä¸éœ€è¦ SQLAlchemy
        self.engine = None
        self.surrealdb_url = f"http://{self.host}:{self.port}/sql"
        self.surrealdb_auth = (self.username, self.password)
        self.surrealdb_namespace = self.kwargs.get('namespace', 'test')
        self.surrealdb_database = self.kwargs.get('database', 'test')
        self.surrealdb_headers = {
            "NS": self.surrealdb_namespace,
            "DB": self.surrealdb_database,
            "Accept": "application/json"
        }
        print(f"âœ… SurrealDB connection configured: {self.surrealdb_url}")
```

### 3.3 `execSQL` æ–¹æ³•
```python
def execSQL(self, sql_statement, fetch=True, timeout=60):
    # ... ç°æœ‰åˆ†æ”¯ ...
    
    elif self.dbType == "SURREALDB":  # â† æ–°å¢åˆ†æ”¯
        import requests
        try:
            response = requests.post(
                self.surrealdb_url,
                data=sql_statement,
                auth=self.surrealdb_auth,
                headers=self.surrealdb_headers,
                timeout=timeout
            )
            
            if response.status_code != 200:
                error_msg = f"HTTP {response.status_code}: {response.text}"
                raise Exception(error_msg)
            
            result = response.json()
            # è½¬æ¢ä¸º SQLAlchemy æ ¼å¼
            if isinstance(result, list) and len(result) > 0:
                first_result = result[0]
                if first_result.get("status") == "OK":
                    rows = first_result.get("result", [])
                    return rows
            return []
            
        except Exception as e:
            raise Exception(f"SurrealDB error: {str(e)}")
```

### 3.4 `check_connection` æ–¹æ³•
```python
def check_connection(self):
    if self.dbType == "SURREALDB":  # â† æ–°å¢åˆ†æ”¯
        import requests
        try:
            health_url = f"http://{self.host}:{self.port}/health"
            response = requests.get(health_url, timeout=5)
            if response.status_code == 200:
                print(f"âœ… SurrealDB connection OK")
                return True
        except:
            pass
        return False
    
    # ... ç°æœ‰ä»£ç ï¼ˆSQLAlchemy å¼•æ“æ£€æŸ¥ï¼‰...
```

### 3.5 `database_clear` å‡½æ•°
```python
def database_clear(dbType, ip, port, username, password, database, **kwargs):
    # ... ç°æœ‰åˆ†æ”¯ ...
    
    elif dbType.lower() == "surrealdb":  # â† æ–°å¢åˆ†æ”¯
        import requests
        namespace = kwargs.get('namespace', 'test')
        url = f"http://{ip}:{port}/sql"
        headers = {"NS": namespace, "DB": database, "Accept": "application/json"}
        sql = f"REMOVE DATABASE {database};"
        response = requests.post(
            url, 
            data=sql, 
            auth=(username, password), 
            headers=headers
        )
        if response.status_code == 200:
            print(f"âœ… Cleared SurrealDB database: {database}")
```

**å…³é”®ç‚¹**ï¼š
- æ ¹æ®æ•°æ®åº“ç‰¹æ€§é€‰æ‹©è¿æ¥æ–¹å¼ï¼ˆSQLAlchemy æˆ– HTTP APIï¼‰
- ç»Ÿä¸€è¿”å›æ ¼å¼ï¼ˆåˆ—è¡¨å½¢å¼ï¼‰
- å¤„ç†æ•°æ®åº“ç‰¹æœ‰çš„è®¤è¯å’Œé…ç½®

---

## 4. çŸ¥è¯†åº“åˆ›å»º âœ…

### ç›®å½•ï¼š`NoSQLFeatureKnowledgeBase/[DatabaseName]/`

**éœ€è¦åˆ›å»ºçš„æ–‡ä»¶**ï¼ˆä»¥ SurrealDB ä¸ºä¾‹ï¼‰ï¼š

### 4.1 `sql_to_[database]_mapping.json`
å­˜å‚¨ SQL åˆ°ç›®æ ‡æ•°æ®åº“çš„æ˜ å°„è§„åˆ™

```json
{
  "critical_syntax_differences": {
    "CREATE_TABLE": {
      "sqlite_pattern": "CREATE TABLE table (col TYPE)",
      "surrealdb_pattern": "DEFINE TABLE table SCHEMAFULL; DEFINE FIELD col ...",
      "severity": "CRITICAL",
      "common_errors": ["CREATE TABLE t0 (c0 STRING)"],
      "correct_translations": [
        {
          "input": "CREATE TABLE t0(c0);",
          "output": "DEFINE TABLE t0 SCHEMAFULL; DEFINE FIELD c0 ..."
        }
      ],
      "notes": "å®Œå…¨ä¸åŒçš„è¯­æ³•"
    }
  },
  "type_mappings": {
    "INTEGER": "int",
    "TEXT": "string",
    "REAL": "float"
  },
  "aggregate_functions": {
    "COUNT(*)": {
      "surrealdb": "count()",
      "notes": "No asterisk"
    },
    "AVG(x)": {
      "surrealdb": "math::mean(x)",
      "notes": "Must use math::mean"
    }
  },
  "unsupported_features": {
    "PRAGMA": {
      "reason": "SQLite-specific",
      "action": "Return comment",
      "examples": ["PRAGMA encoding = 'UTF16be';"]
    }
  },
  "identical_syntax": {
    "SELECT": "SELECT * FROM table WHERE ...",
    "INSERT": "INSERT INTO table VALUES (...)",
    "UPDATE": "UPDATE table SET ... WHERE ..."
  }
}
```

### 4.2 `[database]_translation_rules.json`
ç»“æ„åŒ–çš„ç¿»è¯‘è§„åˆ™

```json
{
  "database": "SurrealDB",
  "version": "2.3.10",
  "query_language": "SurrealQL",
  "translation_rules": [
    {
      "rule_id": "CREATE_TABLE_CRITICAL",
      "priority": "CRITICAL",
      "category": "DDL",
      "sqlite_pattern": "CREATE TABLE {table} ({columns})",
      "surrealdb_pattern": "DEFINE TABLE {table} SCHEMAFULL; ...",
      "description": "å®Œå…¨ä¸åŒçš„è¯­æ³•",
      "examples": [
        {
          "input": "CREATE TABLE t0(c0);",
          "output": "DEFINE TABLE t0 SCHEMAFULL; ...",
          "explanation": "å¿…é¡»æ‹†åˆ†ä¸ºå¤šä¸ªè¯­å¥"
        }
      ],
      "common_errors": ["CREATE TABLE t0 (c0 STRING)"]
    },
    {
      "rule_id": "COUNT_ASTERISK",
      "priority": "HIGH",
      "category": "Aggregate",
      "sqlite_pattern": "COUNT(*)",
      "surrealdb_pattern": "count()",
      "description": "å»æ‰æ˜Ÿå·"
    }
  ]
}
```

**å…³é”®å†…å®¹**ï¼š
- å…³é”®è¯­æ³•å·®å¼‚ï¼ˆæ ‡è®° severityï¼‰
- ç±»å‹æ˜ å°„
- å‡½æ•°æ˜ å°„
- ä¸æ”¯æŒçš„ç‰¹æ€§
- ç›¸åŒè¯­æ³•ï¼ˆå¯é€‰ï¼‰
- ç¿»è¯‘ç¤ºä¾‹

---

## 5. çŸ¥è¯†åº“å¯¼å…¥å™¨é›†æˆ âœ…

### æ–‡ä»¶ï¼š`tools/knowledge_base_importer.py`

**éœ€è¦ä¿®æ”¹ 4 ä¸ªä½ç½®**ï¼š

### 5.1 æ·»åŠ å¯¼å…¥æ–¹æ³•
```python
def import_surrealdb_knowledge(self):
    """å¯¼å…¥ SurrealDB çŸ¥è¯†åº“"""
    print("\nğŸ“š Importing SurrealDB knowledge...")
    db_name = "surrealdb"
    
    # 1. å¯¼å…¥ SQL åˆ° SurrealDB æ˜ å°„
    mapping_path = self.base_path / "NoSQLFeatureKnowledgeBase/SurrealDB/sql_to_surrealdb_mapping.json"
    if mapping_path.exists():
        with open(mapping_path, 'r', encoding='utf-8') as f:
            mapping_data = json.load(f)
        
        # å¯¼å…¥å…³é”®è¯­æ³•å·®å¼‚
        if "critical_syntax_differences" in mapping_data:
            for feature_name, feature_info in mapping_data["critical_syntax_differences"].items():
                memory_text = self._format_surrealdb_critical_syntax(feature_name, feature_info)
                metadata = {
                    "database": db_name,
                    "type": "critical_syntax",
                    "feature_name": feature_name,
                    "severity": feature_info.get("severity", "HIGH"),
                    "source": "sql_mapping"
                }
                self._add_memory(memory_text, db_name, metadata)
        
        # ... å¯¼å…¥å…¶ä»–ç±»å‹ ...
```

### 5.2 æ·»åŠ æ ¼å¼åŒ–æ–¹æ³•
```python
def _format_surrealdb_critical_syntax(self, feature_name: str, feature_info: Dict) -> str:
    """æ ¼å¼åŒ– SurrealDB å…³é”®è¯­æ³•å·®å¼‚"""
    parts = [f"ğŸ”´ CRITICAL: {feature_name} - è¯­æ³•å®Œå…¨ä¸åŒï¼"]
    parts.append(f"SQLite: {feature_info.get('sqlite_pattern', 'N/A')}")
    parts.append(f"SurrealDB: {feature_info.get('surrealdb_pattern', 'N/A')}")
    
    if feature_info.get("common_errors"):
        parts.append("å¸¸è§é”™è¯¯:")
        for err in feature_info["common_errors"][:3]:
            parts.append(f"  âŒ {err}")
    
    if feature_info.get("correct_translations"):
        parts.append("æ­£ç¡®ç¿»è¯‘:")
        for trans in feature_info["correct_translations"][:3]:
            parts.append(f"  âœ… {trans['input']} â†’ {trans['output']}")
    
    return "\n".join(parts)

# ... å…¶ä»–æ ¼å¼åŒ–æ–¹æ³• ...
```

### 5.3 æ·»åŠ å‘½ä»¤è¡Œå‚æ•°
```python
def main():
    parser = argparse.ArgumentParser(description="Import knowledge bases to Mem0")
    parser.add_argument("--nosql", 
                       choices=["mongodb", "redis", "surrealdb"],  # â† æ·»åŠ æ–°æ•°æ®åº“
                       help="Import specific NoSQL database")
```

### 5.4 æ·»åŠ ä¸»å‡½æ•°åˆ†æ”¯
```python
elif args.nosql:
    if args.nosql == "mongodb":
        importer.import_mongodb_knowledge()
    elif args.nosql == "redis":
        importer.import_redis_knowledge()
    elif args.nosql == "surrealdb":  # â† æ–°å¢åˆ†æ”¯
        importer.import_surrealdb_knowledge()
```

---

## 6. ç¿»è¯‘æµç¨‹é›†æˆ âœ…

### æ–‡ä»¶ï¼š`src/TransferLLM/TransferLLM.py`

**éœ€è¦ä¿®æ”¹ 4 ä¸ªä½ç½®**ï¼š

### 6.1 åœ¨ `get_NoSQL_knowledge_string()` ä¸­æ·»åŠ åŠ è½½é€»è¾‘
```python
def get_NoSQL_knowledge_string(origin_db, target_db, with_knowledge, sql_statement_processed):
    # ... ç°æœ‰ä»£ç  ...
    
    nosql_targets = {"redis", "mongodb", "surrealdb"}  # â† æ·»åŠ æ–°æ•°æ®åº“
    
    # === SurrealDB çŸ¥è¯†åº“åŠ è½½ ===
    if str(target_db).lower() == "surrealdb":
        try:
            repo_root = os.path.dirname(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))
            mapping_path = os.path.join(
                repo_root,
                "NoSQLFeatureKnowledgeBase",
                "SurrealDB",
                "sql_to_surrealdb_mapping.json"
            )
            
            if os.path.exists(mapping_path):
                with open(mapping_path, "r", encoding="utf-8") as f:
                    surrealdb_kb = json.load(f)
                
                knowledge_string += "\n========== ğŸ”´ CRITICAL SurrealDB Syntax Rules ==========\n\n"
                
                # 1. å…³é”®è¯­æ³•å·®å¼‚
                if "critical_syntax_differences" in surrealdb_kb:
                    create_table_info = surrealdb_kb["critical_syntax_differences"].get("CREATE_TABLE", {})
                    knowledge_string += "âš ï¸  CREATE TABLE Syntax (MOST IMPORTANT!):\n\n"
                    knowledge_string += f"SQLite: {create_table_info.get('sqlite_pattern')}\n"
                    knowledge_string += f"SurrealDB: {create_table_info.get('surrealdb_pattern')}\n\n"
                    knowledge_string += "âŒ WRONG Examples:\n"
                    for err in create_table_info.get("common_errors", [])[:3]:
                        knowledge_string += f"  - {err}\n"
                    knowledge_string += "\nâœ… CORRECT Examples:\n"
                    for trans in create_table_info.get("correct_translations", [])[:3]:
                        knowledge_string += f"  Input:  {trans['input']}\n"
                        knowledge_string += f"  Output: {trans['output']}\n\n"
                
                # 2. ç±»å‹æ˜ å°„
                if "type_mappings" in surrealdb_kb:
                    knowledge_string += "Type Mappings:\n"
                    for sql_type, surreal_type in surrealdb_kb["type_mappings"].items():
                        knowledge_string += f"  {sql_type} â†’ {surreal_type}\n"
                
                # 3. èšåˆå‡½æ•°
                if "aggregate_functions" in surrealdb_kb:
                    knowledge_string += "\nAggregate Functions:\n"
                    for func_name, func_info in surrealdb_kb["aggregate_functions"].items():
                        knowledge_string += f"  {func_name} â†’ {func_info.get('surrealdb')}\n"
                
                knowledge_string += "\n========================================\n\n"
                print(f"âœ… Loaded SurrealDB knowledge base")
        
        except Exception as e:
            print(f"âŒ Failed to load SurrealDB knowledge: {e}")
    
    elif str(origin_db).lower() == "redis":
        # ... Redis é€»è¾‘ ...
```

### 6.2 åœ¨ `transfer_llm_sql_semantic()` ä¸­æ›´æ–° NOSQL_DBS
```python
def transfer_llm_sql_semantic(...):
    # ... ä»£ç  ...
    
    if with_knowledge:
        NOSQL_DBS = {"redis", "memcached", "etcd", "consul", "mongodb", "surrealdb"}  # â† æ·»åŠ 
        if str(origin_db).lower() in NOSQL_DBS or str(target_db).lower() in NOSQL_DBS:
            feature_knowledge_string = get_NoSQL_knowledge_string(...)
```

### 6.3 åœ¨ `transfer_llm_nosql_crash()` ä¸­æ›´æ–° NOSQL_DBS
```python
def transfer_llm_nosql_crash(...):
    # ... ä»£ç  ...
    
    NOSQL_DBS = {"redis", "memcached", "etcd", "consul", "mongodb", "surrealdb"}  # â† æ·»åŠ 
```

**å…³é”®ç‚¹**ï¼š
- åœ¨ Prompt ä¸­**æ˜¾è‘—æ ‡è®°**å…³é”®å·®å¼‚ï¼ˆä½¿ç”¨ ğŸ”´ã€âš ï¸ã€âŒã€âœ… ç­‰ç¬¦å·ï¼‰
- æä¾›é”™è¯¯ç¤ºä¾‹å’Œæ­£ç¡®ç¤ºä¾‹å¯¹æ¯”
- æŒ‰é‡è¦æ€§æ’åºï¼ˆCRITICAL ä¼˜å…ˆï¼‰

---

## 7. é¢„å¤„ç†è„šæœ¬ï¼ˆå¯é€‰ï¼‰âš™ï¸

### åœºæ™¯ï¼šæºæ•°æ®åº“æœ‰ä¸å¯ç¿»è¯‘çš„è¯­å¥

å¦‚æœæºæ•°æ®åº“ï¼ˆå¦‚ SQLiteï¼‰æœ‰ç›®æ ‡æ•°æ®åº“ä¸æ”¯æŒçš„ç‰¹æ€§ï¼ˆå¦‚ PRAGMAï¼‰ï¼Œåˆ›å»ºè¿‡æ»¤è„šæœ¬ï¼š

### æ–‡ä»¶ï¼š`scripts/[database]/filter_[source]_sql.py`

```python
#!/usr/bin/env python3
"""
è¿‡æ»¤ SQLite SQL è¯­å¥ï¼Œå»é™¤ SurrealDB ä¸æ”¯æŒçš„ç‰¹æ€§
"""
import json
import re

def is_untranslatable(sql_statement):
    """æ£€æŸ¥ SQL æ˜¯å¦ä¸å¯ç¿»è¯‘"""
    sql_upper = sql_statement.strip().upper()
    
    # PRAGMA å‘½ä»¤
    if sql_upper.startswith('PRAGMA'):
        return True, "PRAGMA command"
    
    # ATTACH/DETACH DATABASE
    if 'ATTACH DATABASE' in sql_upper or 'DETACH DATABASE' in sql_upper:
        return True, "ATTACH/DETACH DATABASE"
    
    # VACUUM
    if sql_upper.startswith('VACUUM'):
        return True, "VACUUM command"
    
    return False, None

def filter_jsonl_file(input_file, output_file):
    """è¿‡æ»¤ JSONL æ–‡ä»¶"""
    filtered_count = 0
    total_count = 0
    
    with open(input_file, 'r', encoding='utf-8') as fin, \
         open(output_file, 'w', encoding='utf-8') as fout:
        
        for line in fin:
            total_count += 1
            data = json.loads(line.strip())
            
            # æ£€æŸ¥ sql æˆ– sqls å­—æ®µ
            if 'sqls' in data:
                filtered_sqls = []
                for sql in data['sqls']:
                    is_untr, reason = is_untranslatable(sql)
                    if not is_untr:
                        filtered_sqls.append(sql)
                    else:
                        print(f"ğŸš« Filtered: {sql[:60]}... ({reason})")
                
                if filtered_sqls:
                    data['sqls'] = filtered_sqls
                    fout.write(json.dumps(data, ensure_ascii=False) + '\n')
                else:
                    filtered_count += 1
            
            elif 'sql' in data:
                is_untr, reason = is_untranslatable(data['sql'])
                if not is_untr:
                    fout.write(line)
                else:
                    filtered_count += 1
                    print(f"ğŸš« Filtered: {data['sql'][:60]}... ({reason})")
    
    print(f"\nç»Ÿè®¡: æ€»å…± {total_count} æ¡ï¼Œè¿‡æ»¤ {filtered_count} æ¡")

if __name__ == "__main__":
    filter_jsonl_file("Input/demo1.jsonl", "Input/demo1_surrealdb_filtered.jsonl")
```

---

## 8. æµ‹è¯•éªŒè¯ âœ…

### 8.1 æµ‹è¯•æ•°æ®åº“è¿æ¥
```python
# test_[database]_connection.py
import requests

url = "http://127.0.0.1:8000/sql"
auth = ("root", "root")
headers = {"NS": "test", "DB": "test", "Accept": "application/json"}

# æµ‹è¯•åŸºæœ¬æŸ¥è¯¢
response = requests.post(url, data="INFO FOR DB;", auth=auth, headers=headers)
print(response.json())

# æµ‹è¯•è¡¨åˆ›å»º
sql = "DEFINE TABLE test SCHEMAFULL; DEFINE FIELD name ON TABLE test TYPE string;"
response = requests.post(url, data=sql, auth=auth, headers=headers)
print(response.json())
```

### 8.2 è¿è¡Œç¿»è¯‘æµ‹è¯•
```bash
cd /root/QTRAN
source venv/bin/activate

# è¿è¡Œæµ‹è¯•ï¼ˆä½¿ç”¨è¿‡æ»¤åçš„è¾“å…¥ï¼‰
python -m src.main \
    --input_filename Input/demo1_surrealdb_filtered.jsonl \
    --tool sqlancer \
    --model gpt-4o-mini \
    --temperature 0.3
```

### 8.3 éªŒè¯çŸ¥è¯†åº“åŠ è½½
æŸ¥çœ‹æ—¥å¿—ä¸­æ˜¯å¦æœ‰ï¼š
```
âœ… Loaded SurrealDB knowledge base from: .../sql_to_surrealdb_mapping.json
```

### 8.4 æ£€æŸ¥ç¿»è¯‘ç»“æœ
```bash
# æŸ¥çœ‹è¾“å‡ºæ–‡ä»¶
cat Output/demo1_surrealdb_filtered/sqlancer_surrealdb/results.jsonl

# æ£€æŸ¥æ˜¯å¦è¿˜æœ‰è¯­æ³•é”™è¯¯
grep "CREATE TABLE.*(" Output/demo1_surrealdb_filtered/sqlancer_surrealdb/results.jsonl
```

---

## ğŸ“Š å®Œæ•´æ€§æ£€æŸ¥æ¸…å•

ä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿æ‰€æœ‰æ­¥éª¤å®Œæˆï¼š

### Docker & é…ç½®
- [ ] `docker-compose.yml` æ·»åŠ æœåŠ¡å®šä¹‰
- [ ] `database_connector_args.json` æ·»åŠ è¿æ¥å‚æ•°
- [ ] å®¹å™¨å¯ä»¥æ­£å¸¸å¯åŠ¨

### ä»£ç é›†æˆ
- [ ] `database_connector.py` - `__init__` æ¥æ”¶é¢å¤–å‚æ•°
- [ ] `database_connector.py` - `create_engine` æ·»åŠ åˆ†æ”¯
- [ ] `database_connector.py` - `execSQL` æ·»åŠ åˆ†æ”¯
- [ ] `database_connector.py` - `check_connection` æ·»åŠ åˆ†æ”¯
- [ ] `database_connector.py` - `database_clear` æ·»åŠ åˆ†æ”¯

### çŸ¥è¯†åº“
- [ ] åˆ›å»º `NoSQLFeatureKnowledgeBase/[Database]/` ç›®å½•
- [ ] åˆ›å»º `sql_to_[database]_mapping.json`
- [ ] åˆ›å»º `[database]_translation_rules.json`
- [ ] åŒ…å«å…³é”®è¯­æ³•å·®å¼‚
- [ ] åŒ…å«ç±»å‹æ˜ å°„
- [ ] åŒ…å«å‡½æ•°æ˜ å°„
- [ ] åŒ…å«ä¸æ”¯æŒçš„ç‰¹æ€§

### å¯¼å…¥å™¨
- [ ] `knowledge_base_importer.py` - æ·»åŠ å¯¼å…¥æ–¹æ³•
- [ ] `knowledge_base_importer.py` - æ·»åŠ æ ¼å¼åŒ–æ–¹æ³•ï¼ˆè‡³å°‘ 3-5 ä¸ªï¼‰
- [ ] `knowledge_base_importer.py` - æ›´æ–°å‘½ä»¤è¡Œå‚æ•°
- [ ] `knowledge_base_importer.py` - æ·»åŠ ä¸»å‡½æ•°åˆ†æ”¯

### ç¿»è¯‘æµç¨‹
- [ ] `TransferLLM.py` - `get_NoSQL_knowledge_string()` æ·»åŠ åŠ è½½é€»è¾‘
- [ ] `TransferLLM.py` - æ›´æ–° `nosql_targets` é›†åˆ
- [ ] `TransferLLM.py` - `transfer_llm_sql_semantic()` æ›´æ–° NOSQL_DBS
- [ ] `TransferLLM.py` - `transfer_llm_nosql_crash()` æ›´æ–° NOSQL_DBS
- [ ] Prompt ä¸­æ˜¾è‘—æ ‡è®°å…³é”®å·®å¼‚

### å¯é€‰
- [ ] åˆ›å»ºé¢„å¤„ç†è„šæœ¬ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] åˆ›å»ºæµ‹è¯•è„šæœ¬

### éªŒè¯
- [ ] æ•°æ®åº“è¿æ¥æµ‹è¯•é€šè¿‡
- [ ] çŸ¥è¯†åº“æˆåŠŸåŠ è½½ï¼ˆæ—¥å¿—ç¡®è®¤ï¼‰
- [ ] ç¿»è¯‘èƒ½ç”Ÿæˆæ­£ç¡®è¯­æ³•
- [ ] æ²¡æœ‰é‡å¤çš„è¯­æ³•é”™è¯¯

---

## ğŸ’¡ æœ€ä½³å®è·µ

### 1. ä¼˜å…ˆçº§é¡ºåº
1. **CRITICAL** - å®Œå…¨ä¸åŒçš„è¯­æ³•ï¼ˆå¦‚ CREATE TABLEï¼‰
2. **HIGH** - å¸¸ç”¨åŠŸèƒ½çš„å·®å¼‚ï¼ˆå¦‚èšåˆå‡½æ•°ï¼‰
3. **MEDIUM** - ç±»å‹æ˜ å°„
4. **LOW** - ç›¸åŒæˆ–ç›¸ä¼¼çš„è¯­æ³•

### 2. Prompt è®¾è®¡åŸåˆ™
- âœ… ä½¿ç”¨é†’ç›®ç¬¦å·ï¼ˆğŸ”´ã€âš ï¸ã€âŒã€âœ…ï¼‰
- âœ… é”™è¯¯ç¤ºä¾‹ vs æ­£ç¡®ç¤ºä¾‹å¯¹æ¯”
- âœ… ç®€æ´æ˜äº†ï¼Œé¿å…å†—é•¿æè¿°
- âœ… æŒ‰é‡è¦æ€§æ’åº

### 3. çŸ¥è¯†åº“ç»„ç»‡
- âœ… å…³é”®ä¿¡æ¯æ”¾åœ¨ JSON é¡¶å±‚
- âœ… ä½¿ç”¨ç»“æ„åŒ–å­—æ®µï¼ˆseverity, priority, categoryï¼‰
- âœ… æä¾›å…·ä½“ç¤ºä¾‹è€ŒéæŠ½è±¡æè¿°

### 4. é”™è¯¯å¤„ç†
- âœ… åŠ è½½çŸ¥è¯†åº“å¤±è´¥æ—¶ä¸é˜»å¡æµç¨‹
- âœ… è®°å½•è¯¦ç»†æ—¥å¿—ä¾¿äºè°ƒè¯•
- âœ… æä¾›é™çº§æ–¹æ¡ˆï¼ˆå¦‚ä¸åŠ è½½çŸ¥è¯†åº“ä¹Ÿèƒ½è¿è¡Œï¼‰

---

## ğŸ” è°ƒè¯•æŠ€å·§

### æ£€æŸ¥çŸ¥è¯†åº“æ˜¯å¦åŠ è½½
```python
# åœ¨ TransferLLM.py çš„ get_NoSQL_knowledge_string() ä¸­æ·»åŠ ï¼š
print(f"ğŸ“‹ Knowledge string length: {len(knowledge_string)}")
print(f"ğŸ“‹ First 500 chars: {knowledge_string[:500]}")
```

### æ£€æŸ¥ Prompt å†…å®¹
```python
# åœ¨ transfer_llm_sql_semantic() ä¸­æ·»åŠ ï¼š
print("=" * 80)
print("FINAL PROMPT:")
print(prompt_template.format(
    examples_string=examples_string,
    feature_knowledge_string=feature_knowledge_string,
    ...
))
print("=" * 80)
```

### æ£€æŸ¥ç¿»è¯‘ç»“æœ
```bash
# æŸ¥çœ‹æœ€è¿‘çš„ç¿»è¯‘ç»“æœ
tail -n 20 Output/*/sqlancer_*/results.jsonl

# ç»Ÿè®¡é”™è¯¯ç±»å‹
grep -o "Parse error.*" nohup.out | sort | uniq -c
```

---

## ğŸ“š å‚è€ƒç¤ºä¾‹

å®Œæ•´çš„ SurrealDB é›†æˆå‚è€ƒï¼š
- `docker-compose.yml` - lines 100-110
- `database_connector_args.json` - surrealdb æ¡ç›®
- `database_connector.py` - æœç´¢ "SURREALDB"
- `NoSQLFeatureKnowledgeBase/SurrealDB/` - æ‰€æœ‰æ–‡ä»¶
- `knowledge_base_importer.py` - `import_surrealdb_knowledge()`
- `TransferLLM.py` - line 710-776

---

## âš ï¸ å¸¸è§é™·é˜±

1. **å¿˜è®°æ›´æ–°æ‰€æœ‰ NOSQL_DBS é›†åˆ** â†’ å¯¼è‡´çŸ¥è¯†åº“ä¸åŠ è½½
2. **çŸ¥è¯†åº“è·¯å¾„é”™è¯¯** â†’ æ–‡ä»¶æ‰¾ä¸åˆ°ä½†ä¸æŠ¥é”™
3. **Docker ç½‘ç»œé…ç½®é”™è¯¯** â†’ å®¹å™¨é—´æ— æ³•é€šä¿¡
4. **Prompt æ ¼å¼é—®é¢˜** â†’ LLM æ— æ³•ç†è§£å…³é”®ä¿¡æ¯
5. **ç±»å‹æ˜ å°„ä¸å®Œæ•´** â†’ éƒ¨åˆ†ç±»å‹ç¿»è¯‘é”™è¯¯

---

## ğŸ“ æ€»ç»“

æ–°å¢æ•°æ®åº“çš„æ ¸å¿ƒæ˜¯ï¼š
1. **è®© QTRAN èƒ½è¿ä¸Š**ï¼ˆDocker + è¿æ¥å™¨ï¼‰
2. **è®© LLM çŸ¥é“æ€ä¹ˆç¿»è¯‘**ï¼ˆçŸ¥è¯†åº“ + Promptï¼‰
3. **è®©ç³»ç»Ÿè®¤è¯†å®ƒæ˜¯ NoSQL**ï¼ˆæ›´æ–°é›†åˆå’Œåˆ†æ”¯åˆ¤æ–­ï¼‰

æŒ‰ç…§æ­¤æ¸…å•é€é¡¹å®Œæˆï¼Œæ–°æ•°æ®åº“å°±èƒ½é¡ºåˆ©é›†æˆåˆ° QTRAN ä¸­ï¼

