# åè°ƒå™¨ï¼ˆCoordinatorï¼‰ä½¿ç”¨æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

QTRAN v1.7 å¼•å…¥äº†è½»é‡çº§åè°ƒå™¨æœºåˆ¶ï¼ˆSimpleCoordinatorï¼‰ï¼Œå®ç°äº†åŸºäºé»‘æ¿æ¨¡å¼çš„åŠ¨æ€å·¥ä½œæµè°ƒæ•´ã€‚åè°ƒå™¨å¯ä»¥ä» Mem0 è¯»å–åé¦ˆä¿¡æ¯ï¼ˆRecommendation å’Œ CoverageHotspotï¼‰ï¼Œå¹¶è‡ªåŠ¨è°ƒæ•´ç¿»è¯‘å‚æ•°ä»¥æå‡æµ‹è¯•æ•ˆç‡ã€‚

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½

### 1. çŠ¶æ€è½®è¯¢ï¼ˆPoll Stateï¼‰
ä» Mem0 é»‘æ¿è¯»å–ï¼š
- **Recommendation**ï¼šå˜å¼‚æµ‹è¯•ç”Ÿæˆçš„ç¿»è¯‘å»ºè®®
- **CoverageHotspot**ï¼šé«˜è¦†ç›–ç‡å¢é•¿çš„ç‰¹æ€§ç»„åˆ

### 2. ç­–ç•¥å†³ç­–ï¼ˆDecide Strategyï¼‰
åŸºäºè½®è¯¢çŠ¶æ€è‡ªåŠ¨å†³ç­–ï¼š
- æ˜¯å¦è°ƒæ•´ LLM temperatureï¼ˆé™ä½éšæœºæ€§ï¼‰
- æ˜¯å¦è°ƒæ•´è¿­ä»£æ¬¡æ•°ï¼ˆå¢åŠ é‡è¯•æœºä¼šï¼‰
- æ˜¯å¦å¯ç”¨é«˜ä¼˜å…ˆçº§æ¨¡å¼
- é‡ç‚¹å…³æ³¨å“ªäº› SQL ç‰¹æ€§

### 3. å‚æ•°è°ƒæ•´ï¼ˆAdjust Workflowï¼‰
åŠ¨æ€ä¿®æ”¹ç¿»è¯‘æµç¨‹å‚æ•°ï¼š
- `temperature`ï¼š0.3 â†’ 0.2ï¼ˆé«˜ä¼˜å…ˆçº§å»ºè®®æ—¶ï¼‰
- `iteration_num`ï¼š4 â†’ 6ï¼ˆé«˜è¦†ç›–ç‡ Hotspot æ—¶ï¼‰

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### æ–¹æ³• 1ï¼šé»˜è®¤å¯ç”¨ï¼ˆæ¨èï¼‰

åè°ƒå™¨é»˜è®¤å¯ç”¨ï¼Œåªéœ€ç¡®ä¿è®¾ç½®äº† `QTRAN_USE_MEM0=true`ï¼š

```bash
export QTRAN_USE_MEM0=true
export OPENAI_API_KEY="your_key"
export HTTP_PROXY="http://127.0.0.1:7890"
export HTTPS_PROXY="http://127.0.0.1:7890"

# è¿è¡Œç¿»è¯‘ä»»åŠ¡ï¼Œåè°ƒå™¨ä¼šè‡ªåŠ¨å·¥ä½œ
python -m src.main --input_filename Input/nosql2sqldemo_agent.jsonl --tool sqlancer
```

### æ–¹æ³• 2ï¼šæ˜¾å¼å¯ç”¨

é€šè¿‡å‘½ä»¤è¡Œå‚æ•°æ˜¾å¼å¯ç”¨ï¼š

```bash
python -m src.main \
  --input_filename Input/nosql2sqldemo_agent.jsonl \
  --tool sqlancer \
  --enable_coordinator True
```

### æ–¹æ³• 3ï¼šç¦ç”¨åè°ƒå™¨

å¦‚æœéœ€è¦ç¦ç”¨åè°ƒå™¨ï¼ˆä½¿ç”¨é»˜è®¤å‚æ•°ï¼‰ï¼š

```bash
python -m src.main \
  --input_filename Input/nosql2sqldemo_agent.jsonl \
  --tool sqlancer \
  --enable_coordinator False
```

æˆ–è€…ä¸è®¾ç½® `QTRAN_USE_MEM0` ç¯å¢ƒå˜é‡ã€‚

## ğŸ“Š è¿è¡Œè¾“å‡º

### åˆå§‹åŒ–é˜¶æ®µ

```
============================================================
ğŸ§  åˆå§‹åŒ–åè°ƒå™¨ï¼ˆCoordinatorï¼‰
============================================================
âœ… åè°ƒå™¨ï¼šMem0 è¿æ¥æˆåŠŸ
ğŸ“¡ è½®è¯¢é»‘æ¿çŠ¶æ€...
ğŸ¤” åˆ†æåé¦ˆå¹¶å†³ç­–ç­–ç•¥...
âš™ï¸ åº”ç”¨ç­–ç•¥è°ƒæ•´...
ğŸ¯ åè°ƒå™¨ï¼šè°ƒæ•´ temperature â†’ 0.2
ğŸ¯ åè°ƒå™¨ï¼šè°ƒæ•´ iteration_num â†’ 6
ğŸš€ åè°ƒå™¨ï¼šé«˜ä¼˜å…ˆçº§æ¨¡å¼æ¿€æ´»
   æ¨èåŠ¨ä½œ: ä¼˜å…ˆç”ŸæˆåŒ…å« HEX() å’Œèšåˆå‡½æ•°çš„ SQL
ğŸ” åè°ƒå™¨ï¼šé‡ç‚¹å…³æ³¨ç‰¹æ€§ â†’ HEX, MIN, aggregate
âœ… åè°ƒå™¨åˆå§‹åŒ–å®Œæˆ
```

### ä»»åŠ¡ç»“æŸæ—¶

```
============================================================
ğŸ“Š åè°ƒå™¨è¿è¡Œç»Ÿè®¡
============================================================
  æ€» Recommendation æ•°: 12
  é«˜ä¼˜å…ˆçº§å»ºè®®æ•°: 3
  åº”ç”¨çš„å»ºè®®æ•°: 3
  æ£€æµ‹åˆ°çš„ Hotspot æ•°: 5
  ç­–ç•¥è°ƒæ•´æ¬¡æ•°: 4
============================================================
```

## ğŸ”§ é…ç½®é€‰é¡¹

### ç¯å¢ƒå˜é‡

| å˜é‡ | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `QTRAN_USE_MEM0` | å¯ç”¨ Mem0ï¼ˆåè°ƒå™¨å¿…éœ€ï¼‰ | `false` |
| `OPENAI_API_KEY` | OpenAI API å¯†é’¥ | - |
| `HTTP_PROXY` | HTTP ä»£ç† | - |
| `HTTPS_PROXY` | HTTPS ä»£ç† | - |

### å‘½ä»¤è¡Œå‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--enable_coordinator` | å¯ç”¨åè°ƒå™¨ | `True` |
| `--temperature` | åŸºç¡€ temperature | `0.3` |
| `--iteration_num` | åŸºç¡€è¿­ä»£æ¬¡æ•° | `4` |
| `--model` | LLM æ¨¡å‹ | `gpt-4o-mini` |

## ğŸ§  å†³ç­–è§„åˆ™

åè°ƒå™¨ä½¿ç”¨ä»¥ä¸‹è§„åˆ™è¿›è¡Œå†³ç­–ï¼š

### è§„åˆ™ 1ï¼šé«˜ä¼˜å…ˆçº§å»ºè®® â†’ é™ä½éšæœºæ€§

```python
if has_high_priority_recommendation (priority >= 8):
    temperature = 0.2  # é™ä½ temperature
    priority_boost = True
    extract focus_features from recommendation
```

**æ•ˆæœ**ï¼šæå‡ç¿»è¯‘ç¨³å®šæ€§ï¼Œä¼˜å…ˆç”Ÿæˆå»ºè®®çš„ç‰¹æ€§ã€‚

### è§„åˆ™ 2ï¼šé«˜è¦†ç›–ç‡ Hotspot â†’ å¢åŠ è¿­ä»£

```python
if hotspot.avg_coverage_gain > 10:
    iteration_num = 6  # å¢åŠ è¿­ä»£æ¬¡æ•°
```

**æ•ˆæœ**ï¼šç»™äºˆæ›´å¤šé‡è¯•æœºä¼šï¼Œæå‡æˆåŠŸç‡ã€‚

### è§„åˆ™ 3ï¼šæ— åé¦ˆ â†’ æ¢ç´¢æ¨¡å¼

```python
if no_recommendations and no_hotspots:
    recommended_action = "æ¢ç´¢æ¨¡å¼ï¼šæ­£å¸¸æ‰§è¡Œç¿»è¯‘æµç¨‹"
```

**æ•ˆæœ**ï¼šä¿æŒé»˜è®¤å‚æ•°ï¼Œæ­£å¸¸æ¢ç´¢ã€‚

## ğŸ“ˆ é¢„æœŸæ•ˆæœ

æ ¹æ® DCFF è®¾è®¡æ–‡æ¡£é¢„æœŸï¼š

| æŒ‡æ ‡ | é¢„æœŸæå‡ |
|------|---------|
| Bug æ£€å‡ºç‡ | +20-30% |
| è¦†ç›–ç‡å¢é•¿é€Ÿåº¦ | +30-40% |
| æµ‹è¯•æ•ˆç‡ | +15-25% |
| é¦–æ¬¡æˆåŠŸç‡ | ~90% |

## ğŸ” æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼šåè°ƒå™¨æœªå¯åŠ¨

**ç°è±¡**ï¼š
```
â„¹ï¸ åè°ƒå™¨æœªå¯ç”¨ï¼šéœ€è¦è®¾ç½® QTRAN_USE_MEM0=true
```

**è§£å†³**ï¼š
```bash
export QTRAN_USE_MEM0=true
```

### é—®é¢˜ 2ï¼šMem0 è¿æ¥å¤±è´¥

**ç°è±¡**ï¼š
```
âš ï¸ åè°ƒå™¨ï¼šMem0 åˆå§‹åŒ–å¤±è´¥ (ConnectionError)ï¼Œåè°ƒåŠŸèƒ½éƒ¨åˆ†å—é™
```

**è§£å†³**ï¼š
1. æ£€æŸ¥ Mem0 æœåŠ¡æ˜¯å¦è¿è¡Œ
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ£€æŸ¥ `TransferMemoryManager` é…ç½®

### é—®é¢˜ 3ï¼šæ—  Recommendation ç”Ÿæˆ

**ç°è±¡**ï¼šç»Ÿè®¡æŠ¥å‘Šæ˜¾ç¤º `æ€» Recommendation æ•°: 0`

**åŸå› **ï¼š
- é¦–æ¬¡è¿è¡Œæ—¶è¿˜æ²¡æœ‰å˜å¼‚æµ‹è¯•åé¦ˆ
- å˜å¼‚æµ‹è¯•æœªå‘ç° Oracle å¤±è´¥

**å»ºè®®**ï¼š
- è¿è¡Œå¤šè½®æµ‹è¯•ç§¯ç´¯åé¦ˆ
- æ£€æŸ¥å˜å¼‚æµ‹è¯•æ˜¯å¦æ­£å¸¸è¿è¡Œ

## ğŸ¯ æœ€ä½³å®è·µ

### 1. æ¸è¿›å¼å¯ç”¨

```bash
# ç¬¬ä¸€æ¬¡è¿è¡Œï¼šæ”¶é›†åŸºå‡†æ•°æ®ï¼ˆç¦ç”¨åè°ƒå™¨ï¼‰
python -m src.main --input_filename input.jsonl --tool sqlancer --enable_coordinator False

# ç¬¬äºŒæ¬¡è¿è¡Œï¼šå¯ç”¨åè°ƒå™¨ï¼Œè§‚å¯Ÿæ•ˆæœ
python -m src.main --input_filename input.jsonl --tool sqlancer --enable_coordinator True
```

### 2. ç›‘æ§ç»Ÿè®¡æ•°æ®

å…³æ³¨åè°ƒå™¨è¿è¡Œç»Ÿè®¡ï¼š
- **åº”ç”¨çš„å»ºè®®æ•° > 0**ï¼šè¯´æ˜åé¦ˆæœºåˆ¶ç”Ÿæ•ˆ
- **ç­–ç•¥è°ƒæ•´æ¬¡æ•° > 0**ï¼šè¯´æ˜åè°ƒå™¨åœ¨åŠ¨æ€è°ƒæ•´å‚æ•°
- **é«˜ä¼˜å…ˆçº§å»ºè®®æ•°**ï¼šåæ˜ ç³»ç»Ÿå‘ç°çš„é«˜ä»·å€¼ç‰¹æ€§

### 3. ç»“åˆ Mem0 æ£€æŸ¥

```python
from src.TransferLLM.TransferMemoryManager import TransferMemoryManager

manager = TransferMemoryManager(user_id="qtran_redis_to_mongodb")

# æŸ¥çœ‹æ‰€æœ‰ Recommendation
recs = manager.get_all_recommendations(limit=20)
for rec in recs:
    print(f"Priority: {rec['priority']}, Action: {rec.get('action_directive', 'N/A')}")

# æŸ¥çœ‹æ‰€æœ‰ Hotspot
hotspots = manager.get_all_hotspots(limit=10)
for hotspot in hotspots:
    print(f"Features: {hotspot['features']}, Coverage Gain: {hotspot['avg_coverage_gain']}")
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å½“å‰ç³»ç»Ÿ vs DCFF è®¾è®¡å¯¹æ¯”](../research/é‡è¦/å½“å‰ç³»ç»Ÿ_vs_DCFFè®¾è®¡å¯¹æ¯”.md)
- [TransferMemoryManager API](../src/TransferLLM/TransferMemoryManager.py)
- [Recommendation å’Œ Hotspot è®¾è®¡](../research/é‡è¦/å½“å‰ç³»ç»Ÿ_vs_DCFFè®¾è®¡å¯¹æ¯”.md#1-åå‘åé¦ˆæœºåˆ¶)

## ğŸ”„ ä¸‹ä¸€æ­¥è®¡åˆ’

æ ¹æ®è®¾è®¡æ–‡æ¡£ï¼Œåè°ƒå™¨å¯ä»¥è¿›ä¸€æ­¥æ¼”è¿›ï¼š

1. **é˜¶æ®µ 2**ï¼šå°è£…ç‹¬ç«‹çš„ Translation Agent å’Œ Mutation Agent
2. **é˜¶æ®µ 3**ï¼šå®ç°å®Œæ•´çš„é»‘æ¿æ¶æ„å’Œæ›´å¤æ‚çš„ç­–ç•¥å†³ç­–
3. **æœªæ¥**ï¼šæ”¯æŒæ›´å¤šå®ä½“ï¼ˆTranslationPatternã€MutationStepã€CaseHistoryï¼‰

å½“å‰çš„ `SimpleCoordinator` æ˜¯æœ€å°å¯è¡Œç‰ˆæœ¬ï¼ˆMVPï¼‰ï¼Œæä¾›äº†æ ¸å¿ƒçš„åå‘åé¦ˆå’ŒåŠ¨æ€è°ƒæ•´åŠŸèƒ½ã€‚

---

**ç‰ˆæœ¬**ï¼šv1.7  
**æ›´æ–°æ—¥æœŸ**ï¼š2025-10-27  
**çŠ¶æ€**ï¼šâœ… å¯ç”¨

