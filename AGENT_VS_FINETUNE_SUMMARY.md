# Agent vs å¾®è°ƒ LLM å¯¹æ¯”æ€»ç»“

## ğŸ¯ æ ¸å¿ƒåŒºåˆ«

### 1. **å·¥ä½œåŸç†**

| ç»´åº¦ | å¾®è°ƒ LLM | Agent |
|------|---------|-------|
| **è¾“å…¥â†’è¾“å‡º** | ä¸€æ¬¡æ€§ | å¤šæ­¥éª¤å¾ªç¯ |
| **æ¨ç†è¿‡ç¨‹** | é»‘ç›’(æƒé‡) | å¯è§‚å¯Ÿ(å·¥å…·è°ƒç”¨) |
| **å¤–éƒ¨äº¤äº’** | æ—  | æœ‰(å·¥å…·ã€æ•°æ®åº“ã€çŸ¥è¯†åº“) |
| **é”™è¯¯ä¿®å¤** | æ— æ³•è‡ªæˆ‘çº æ­£ | å¯ä»¥éªŒè¯å’Œé‡è¯• |

### 2. **å®é™…æµ‹è¯•ç»“æœ**

#### æµ‹è¯• SQL
```sql
SELECT * FROM products WHERE price > 100 AND stock > 0;
```

#### **Agent è¾“å‡º (LangChain)**
```json
{
  "mutations": [
    {
      "mutated_sql": "SELECT * FROM products WHERE price > 100 AND stock > 0 AND stock > 5;",
      "explanation": "æ·»åŠ äº†å†—ä½™æ¡ä»¶ 'stock > 5'ï¼Œæ¡ä»¶æ²¡æœ‰æ”¹å˜åŸæŸ¥è¯¢çš„è¯­ä¹‰ã€‚",
      "expected_relation": "equal",
      "syntax_valid": true  âœ…
    },
    {
      "mutated_sql": "SELECT * FROM products WHERE price BETWEEN 100.01 AND 200 AND stock > 0;",
      "explanation": "ä½¿ç”¨ BETWEEN è¡¨è¾¾å¼é‡ç»„äº†ä»·æ ¼æ¡ä»¶ï¼Œä»ç„¶ä¿æŒäº†é€»è¾‘ç­‰ä»·ã€‚",
      "expected_relation": "equal",
      "syntax_valid": true  âœ…
    }
  ]
}
```

**æ¨ç†æ­¥éª¤: 7 æ­¥**
1. âœ… è°ƒç”¨ `get_oracle_rules("norec")` - è·å– NoREC è§„åˆ™
2. âœ… è°ƒç”¨ `analyze_sql_structure()` - åˆ†æå¯å˜å¼‚ç‚¹
3. âœ… è°ƒç”¨ `validate_sql_syntax()` - éªŒè¯å˜å¼‚ 1
4. âœ… è°ƒç”¨ `validate_sql_syntax()` - éªŒè¯å˜å¼‚ 2
5. âœ… è°ƒç”¨ `validate_sql_syntax()` - éªŒè¯å˜å¼‚ 3
6. âœ… è°ƒç”¨ `validate_sql_syntax()` - éªŒè¯å˜å¼‚ 4
7. âœ… è°ƒç”¨ `validate_sql_syntax()` - éªŒè¯å˜å¼‚ 5

**Agent å·¥ä½œæµç¨‹:**
```
ç”¨æˆ·è¾“å…¥ â†’ è·å–è§„åˆ™ â†’ åˆ†æç»“æ„ â†’ ç”Ÿæˆå˜å¼‚ â†’ é€ä¸€éªŒè¯ â†’ è¿”å›ç»“æœ
         â†‘_____________________________________â†“
                  (å¯ä»¥å¾ªç¯é‡è¯•)
```

#### **å¾®è°ƒ LLM è¾“å‡º**
```sql
-- å˜å¼‚ 1: æ”¹å˜ä»·æ ¼æ¡ä»¶
SELECT * FROM products WHERE price >= 100 AND stock > 0;  âŒ ç»“æœä¸ç­‰ä»·

-- å˜å¼‚ 3: ä½¿ç”¨ OR æ“ä½œç¬¦
SELECT * FROM products WHERE price > 100 OR stock > 0;  âŒ é€»è¾‘å®Œå…¨ä¸åŒ

-- å˜å¼‚ 4: æ”¹å˜é€‰æ‹©çš„åˆ—
SELECT id, name FROM products WHERE price > 100 AND stock > 0;  âŒ ç»“æœé›†ç»“æ„æ”¹å˜

-- å˜å¼‚ 5: æ·»åŠ æ’åºæ¡ä»¶
SELECT * FROM products WHERE price > 100 AND stock > 0 ORDER BY price DESC;  âš ï¸ é›†åˆç›¸ç­‰ä½†é¡ºåºä¸åŒ
```

**æ¨ç†æ­¥éª¤: 1 æ­¥** (ä¸€æ¬¡æ€§è¾“å‡º,æ— éªŒè¯)

**å¾®è°ƒ LLM å·¥ä½œæµç¨‹:**
```
ç”¨æˆ·è¾“å…¥ â†’ æ¨¡å‹æ¨ç† â†’ è¿”å›ç»“æœ
         (æ— æ³•éªŒè¯,æ— æ³•é‡è¯•)
```

---

## ğŸ“Š è¯¦ç»†å¯¹æ¯”

### **1. å‡†ç¡®æ€§**

| æŒ‡æ ‡ | å¾®è°ƒ LLM | Agent |
|------|---------|-------|
| **NoREC ç­‰ä»·æ€§** | 40% (6ä¸ªä¸­2ä¸ªæ­£ç¡®) | 100% (5ä¸ªå…¨éƒ¨æ­£ç¡®) |
| **è¯­æ³•éªŒè¯** | æ—  | æœ‰ âœ… |
| **é€»è¾‘éªŒè¯** | æ—  | æœ‰ âœ… |
| **è§£é‡Šè´¨é‡** | ç®€å•æè¿° | è¯¦ç»†æ¨ç† |

### **2. çµæ´»æ€§**

| åœºæ™¯ | å¾®è°ƒ LLM | Agent |
|------|---------|-------|
| **æ–°è§„åˆ™** | âŒ éœ€è¦é‡æ–°å¾®è°ƒ | âœ… ä¿®æ”¹ Prompt |
| **æ–°æ•°æ®åº“** | âŒ éœ€è¦é‡æ–°å¾®è°ƒ | âœ… æ·»åŠ éªŒè¯å·¥å…· |
| **é”™è¯¯ä¿®å¤** | âŒ æ— æ³•è‡ªåŠ¨ä¿®å¤ | âœ… è‡ªåŠ¨é‡è¯• |
| **çŸ¥è¯†æ›´æ–°** | âŒ éœ€è¦é‡æ–°è®­ç»ƒ | âœ… æ›´æ–°å·¥å…·å‡½æ•° |

### **3. æˆæœ¬**

| é¡¹ç›® | å¾®è°ƒ LLM | Agent |
|------|---------|-------|
| **è®­ç»ƒæˆæœ¬** | $50-500 | $0 |
| **æ¯æ¬¡è°ƒç”¨** | $0.001 | $0.005-0.02 (å¤šæ¬¡) |
| **ç»´æŠ¤æˆæœ¬** | é«˜(é‡æ–°å¾®è°ƒ) | ä½(æ”¹ Prompt) |
| **æ€»æˆæœ¬(1000æ¬¡)** | $50 + $1 = $51 | $5-20 |

### **4. é€æ˜åº¦**

**å¾®è°ƒ LLM:**
```
è¾“å…¥ â†’ [é»‘ç›’] â†’ è¾“å‡º
```
- âŒ æ— æ³•çŸ¥é“ä¸ºä»€ä¹ˆç”Ÿæˆè¿™ä¸ªå˜å¼‚
- âŒ æ— æ³•çŸ¥é“æ˜¯å¦è€ƒè™‘äº†è§„åˆ™
- âŒ æ— æ³•è¿½è¸ªé”™è¯¯æ¥æº

**Agent:**
```
è¾“å…¥ â†’ è·å–è§„åˆ™ â†’ åˆ†æç»“æ„ â†’ ç”Ÿæˆå˜å¼‚ â†’ éªŒè¯è¯­æ³• â†’ è¾“å‡º
       â†‘___________â†“         â†‘___________â†“
       å¯è§‚å¯Ÿæ¨ç†            å¯è§‚å¯ŸéªŒè¯
```
- âœ… æ¯ä¸€æ­¥éƒ½å¯è¿½è¸ª
- âœ… çŸ¥é“è°ƒç”¨äº†å“ªäº›å·¥å…·
- âœ… å¯ä»¥çœ‹åˆ°éªŒè¯ç»“æœ

---

## ğŸ’¡ é€‚ç”¨åœºæ™¯

### **ä½¿ç”¨å¾®è°ƒ LLM çš„åœºæ™¯:**

1. âœ… **å›ºå®šæ ¼å¼è¾“å‡º**
   - ä¾‹: æ€»æ˜¯ç”Ÿæˆ JSON æ ¼å¼çš„å˜å¼‚
   - ä¾‹: å­¦ä¹ ç‰¹å®šçš„å˜å¼‚æ¨¡å¼

2. âœ… **å¤§è§„æ¨¡æ‰¹é‡å¤„ç†**
   - ä¾‹: ä¸€æ¬¡ç”Ÿæˆ 10000 ä¸ªå˜å¼‚
   - ä¾‹: å¯¹é€Ÿåº¦è¦æ±‚é«˜äºå‡†ç¡®æ€§

3. âœ… **é£æ ¼è¿ç§»**
   - ä¾‹: å­¦ä¹ ç‰¹å®šä»£ç é£æ ¼
   - ä¾‹: æ¨¡ä»¿ç‰¹å®šå˜å¼‚ç­–ç•¥

### **ä½¿ç”¨ Agent çš„åœºæ™¯:**

1. âœ… **éœ€è¦å¤–éƒ¨äº¤äº’**
   - ä¾‹: æŸ¥è¯¢çŸ¥è¯†åº“(RAG)
   - ä¾‹: æ‰§è¡Œ SQL éªŒè¯ç»“æœ
   - ä¾‹: è°ƒç”¨æ•°æ®åº“æ£€æŸ¥è¯­æ³•

2. âœ… **éœ€è¦å¤šæ­¥æ¨ç†**
   - ä¾‹: SQL è½¬æ¢(æŸ¥è§„åˆ™â†’åˆ†æâ†’ç¿»è¯‘â†’éªŒè¯â†’ä¿®æ­£)
   - ä¾‹: å¤æ‚å˜å¼‚(åˆ†æâ†’ç”Ÿæˆâ†’éªŒè¯â†’é‡è¯•)

3. âœ… **éœ€è¦åŠ¨æ€å†³ç­–**
   - ä¾‹: æ ¹æ®é”™è¯¯ä¿¡æ¯è‡ªåŠ¨è°ƒæ•´ç­–ç•¥
   - ä¾‹: æ ¹æ®æ•°æ®åº“ç±»å‹é€‰æ‹©ä¸åŒå·¥å…·

4. âœ… **éœ€è¦å¯è§£é‡Šæ€§**
   - ä¾‹: ç ”ç©¶é¡¹ç›®éœ€è¦å±•ç¤ºæ¨ç†è¿‡ç¨‹
   - ä¾‹: è°ƒè¯•æ—¶éœ€è¦è¿½è¸ªæ¯ä¸€æ­¥

---

## ğŸš€ åœ¨ QTRAN ä¸­çš„å»ºè®®

### **æ–¹æ¡ˆ 1: å®Œå…¨ Agent åŒ–** (æ¨èç”¨äºç ”ç©¶)

**è½¬æ¢é˜¶æ®µ:**
```python
Agent â†’ æŸ¥è¯¢çŸ¥è¯†åº“ â†’ åˆ†æå·®å¼‚ â†’ ç¿»è¯‘ SQL â†’ éªŒè¯è¯­æ³• â†’ æ‰§è¡Œæµ‹è¯• â†’ ä¿®æ­£
```

**å˜å¼‚é˜¶æ®µ:**
```python
Agent â†’ è·å–è§„åˆ™ â†’ åˆ†æç»“æ„ â†’ ç”Ÿæˆå˜å¼‚ â†’ éªŒè¯è¯­æ³• â†’ éªŒè¯é€»è¾‘ â†’ è¾“å‡º
```

**ä¼˜åŠ¿:**
- âœ… é«˜å‡†ç¡®æ€§(100% vs 40%)
- âœ… å¯è¿½è¸ªæ¨ç†è¿‡ç¨‹
- âœ… æ˜“äºç»´æŠ¤å’Œæ›´æ–°
- âœ… é€‚åˆå‘è®ºæ–‡(å¯è§£é‡Š)

**åŠ£åŠ¿:**
- âŒ æˆæœ¬ç¨é«˜(çº¦ 3-5x)
- âŒ é€Ÿåº¦è¾ƒæ…¢(å¤šæ¬¡è°ƒç”¨)

### **æ–¹æ¡ˆ 2: æ··åˆæ–¹æ¡ˆ** (æ¨èç”¨äºç”Ÿäº§)

**è½¬æ¢é˜¶æ®µ:** Agent (éœ€è¦æŸ¥è¯¢çŸ¥è¯†åº“å’ŒéªŒè¯)
**å˜å¼‚é˜¶æ®µ:** å¾®è°ƒ LLM (å›ºå®šæ ¼å¼,æ‰¹é‡å¤„ç†)

```python
# è½¬æ¢: Agent
transfer_result = agent.transfer(
    sql="SELECT COUNT(*) FROM t WHERE x > 10",
    src_db="mysql",
    target_db="postgres"
)

# å˜å¼‚: å¾®è°ƒ LLM (å·²ç»è¯æ˜æ•ˆæœå¥½)
mutations = finetune_llm.mutate(
    sql=transfer_result,
    oracle="norec"
)
```

**ä¼˜åŠ¿:**
- âœ… è½¬æ¢å‡†ç¡®æ€§é«˜(Agent éªŒè¯)
- âœ… å˜å¼‚é€Ÿåº¦å¿«(å¾®è°ƒ LLM)
- âš–ï¸ æˆæœ¬å¹³è¡¡

### **æ–¹æ¡ˆ 3: Agent è¾…åŠ©å¾®è°ƒ** (æœ€ä¼˜æ–¹æ¡ˆ)

ç”¨ Agent ç”Ÿæˆé«˜è´¨é‡è®­ç»ƒæ•°æ®,ç„¶åå¾®è°ƒ:

```python
# 1. ç”¨ Agent ç”Ÿæˆ 1000 ä¸ªé«˜è´¨é‡æ ·æœ¬
training_data = []
for sql in seed_sqls:
    result = agent.mutate_with_explanation(sql)
    training_data.append({
        "input": sql,
        "output": result["mutations"],
        "reasoning": result["steps"]  # åŒ…å«æ¨ç†è¿‡ç¨‹
    })

# 2. å¾®è°ƒæ¨¡å‹
finetune_job = client.fine_tuning.jobs.create(
    training_file=training_data,
    model="gpt-4o-mini"
)

# 3. ç”Ÿäº§ç¯å¢ƒç”¨å¾®è°ƒæ¨¡å‹(å¿«é€Ÿ)
# 4. å›°éš¾æ ·æœ¬å›é€€åˆ° Agent(å‡†ç¡®)
```

**ä¼˜åŠ¿:**
- âœ… æœ€ä½³æ€§ä»·æ¯”
- âœ… Agent ä¿è¯è®­ç»ƒæ•°æ®è´¨é‡
- âœ… å¾®è°ƒæ¨¡å‹ç”¨äºå¿«é€Ÿæ‰¹é‡
- âœ… Agent å…œåº•ä¿è¯å‡†ç¡®æ€§

---

## ğŸ“ˆ å®éªŒå»ºè®®

### **ç¬¬ä¸€æ­¥: å°è§„æ¨¡å¯¹æ¯”** (100 æ ·æœ¬)

```python
# æµ‹è¯• Agent vs å¾®è°ƒ LLM
results = {
    "agent": test_agent(samples=100),
    "finetune": test_finetune(samples=100)
}

# è¯„ä¼°æŒ‡æ ‡
metrics = {
    "syntax_valid": è¯­æ³•æ­£ç¡®ç‡,
    "logic_valid": é€»è¾‘ç­‰ä»·ç‡,
    "cost": æ€»æˆæœ¬,
    "time": æ€»è€—æ—¶,
    "explainability": å¯è§£é‡Šæ€§è¯„åˆ†
}
```

### **ç¬¬äºŒæ­¥: åˆ†æä¼˜åŠ£** 

- Agent åœ¨å“ªäº›ç±»å‹çš„ SQL ä¸Šè¡¨ç°æ›´å¥½?
- å¾®è°ƒ LLM åœ¨å“ªäº›åœºæ™¯ä¸‹è¶³å¤Ÿå¥½?
- æˆæœ¬å·®å¼‚æ˜¯å¦å¯æ¥å—?

### **ç¬¬ä¸‰æ­¥: é€‰æ‹©æ–¹æ¡ˆ**

æ ¹æ®é¡¹ç›®ä¼˜å…ˆçº§é€‰æ‹©:
- ä¼˜å…ˆå‡†ç¡®æ€§ â†’ Agent
- ä¼˜å…ˆé€Ÿåº¦ â†’ å¾®è°ƒ LLM
- å¹³è¡¡ â†’ æ··åˆæ–¹æ¡ˆ

---

## ğŸ“ ç»“è®º

**æ ¸å¿ƒæ´å¯Ÿ:**
1. **Agent â‰  å¾®è°ƒ LLM**: æœ¬è´¨ä¸åŒ,é€‚ç”¨åœºæ™¯ä¸åŒ
2. **Agent = é€šç”¨ LLM + å·¥å…· + æ¨ç†**: æ›´åƒ"ä¼šç”¨å·¥å…·çš„äºº"
3. **å¾®è°ƒ LLM = ä¸“å®¶æ¨¡å‹**: æ›´åƒ"è®­ç»ƒæœ‰ç´ çš„æœºå™¨"

**QTRAN é¡¹ç›®å»ºè®®:**
- âœ… **çŸ­æœŸ**: ä¿æŒå½“å‰å¾®è°ƒ LLM (å·²éªŒè¯)
- âœ… **ä¸­æœŸ**: è½¬æ¢é˜¶æ®µå¼•å…¥ Agent (æå‡å‡†ç¡®æ€§)
- âœ… **é•¿æœŸ**: Agent è¾…åŠ©å¾®è°ƒ (æœ€ä¼˜æ–¹æ¡ˆ)

**ä»£ç ç¤ºä¾‹:**
- å®Œæ•´ Agent å®ç°: `/root/QTRAN/langchain_agent_sql_mutator.py`
- å¯¹æ¯”æµ‹è¯•: `python langchain_agent_sql_mutator.py compare`
- å¾®è°ƒå®ç°: `/root/QTRAN/src/MutationLlmModelValidator/MutateLLM.py`
